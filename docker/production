FROM python:3.10-bullseye

RUN mkdir -p /app
RUN mkdir -p /app/molmod
RUN mkdir -p /app/log

COPY molmod/ /app/molmod/
COPY log/ /app/log/
COPY wsgi.py /app/
COPY config/uwsgi-config.ini /app/
RUN chown -R www-data:www-data /app/

RUN mkdir -p /uploads
RUN chown www-data:www-data /uploads

WORKDIR /app

RUN pip3 install -r molmod/requirements.txt
RUN pip3 install uwsgi

RUN apt-get update
RUN apt-get -y install rsync # Used in backup script

ENV RUN_ENV="production"
CMD ["uwsgi", "--ini", "uwsgi-config.ini", "--uid", "www-data"]
